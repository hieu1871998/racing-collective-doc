

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RC Documentation containers/private/listings.tsx</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="styles/style.css">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
             
                <a class="image" href="index.html">
                    <img src="public/assets/images/logos/rc-logo-primary.svg" alt="logo">
                </a>
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Development Documentation</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://gitlab.fruitful.io/prism/prism-buybloodstock-next"
                        >
                            Repository
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Interfaces</h3><ul><li><a href="ActionMenuProps.html">ActionMenuProps</a></li><li><a href="AnchorInterface.html">AnchorInterface</a></li><li><a href="CustomizedUploadProps.html">CustomizedUploadProps</a></li><li><a href="EllipsisProps.html">EllipsisProps</a></li><li><a href="EnquiryDetailProps.html">EnquiryDetailProps</a></li><li><a href="HomeBannerCarouselProps.html">HomeBannerCarouselProps</a></li><li><a href="HorseEditFormProps.html">HorseEditFormProps</a></li><li><a href="ItemWrapperStyledProps.html">ItemWrapperStyledProps</a></li><li><a href="ListingType.html">ListingType</a></li><li><a href="ModifiedResultProps.html">ModifiedResultProps</a></li><li><a href="MustReadPanelProps.html">MustReadPanelProps</a></li><li><a href="MustReadPanelSkeletonProps.html">MustReadPanelSkeletonProps</a></li><li><a href="NewsDetailProps.html">NewsDetailProps</a></li><li><a href="NewsDetailWrapperStyleProps.html">NewsDetailWrapperStyleProps</a></li><li><a href="NewsItemProps.html">NewsItemProps</a></li><li><a href="NewsPreviewProps.html">NewsPreviewProps</a></li><li><a href="NewsPreviewStyledProps.html">NewsPreviewStyledProps</a></li><li><a href="NoResultProps.html">NoResultProps</a></li><li><a href="ShareButtonProps.html">ShareButtonProps</a></li><li><a href="ShareMenuProps.html">ShareMenuProps</a></li><li><a href="ShareOnSocialsProps.html">ShareOnSocialsProps</a></li><li><a href="UploadImageProps.html">UploadImageProps</a></li></ul><h3>Components</h3><ul><li><a href="ActionMenu.html">ActionMenu</a></li><li><a href="DrawerHandle.html">DrawerHandle</a></li><li><a href="EnquiryDetail.html">EnquiryDetail</a></li><li><a href="FilterBlock.html">FilterBlock</a></li><li><a href="HomeBannerCarousel.html">HomeBannerCarousel</a></li><li><a href="HorseEditForm.html">HorseEditForm</a></li><li><a href="MustReadPanel.html">MustReadPanel</a></li><li><a href="MustReadPanelSkeleton.html">MustReadPanelSkeleton</a></li><li><a href="NewsDetail.html">NewsDetail</a></li><li><a href="NewsFilter.html">NewsFilter</a></li><li><a href="NewsItem.html">NewsItem</a></li><li><a href="NoResult.html">NoResult</a></li><li><a href="ShareButton.html">ShareButton</a></li><li><a href="ShareMenu.html">ShareMenu</a></li><li><a href="ShareOnSocials.html">ShareOnSocials</a></li><li><a href="SkeletonCard.html">SkeletonCard</a></li><li><a href="TileAdCarousel.html">TileAdCarousel</a></li><li><a href="TileAdItem.html">TileAdItem</a></li><li><a href="UploadFile.html">UploadFile</a></li><li><a href="UploadImage.html">UploadImage</a></li></ul><h3>Global</h3><ul><li><a href="global.html#FieldDropdown">FieldDropdown</a></li><li><a href="global.html#getHorseLink">getHorseLink</a></li><li><a href="global.html#handleCancel">handleCancel</a></li><li><a href="global.html#HOME_BANNERS">HOME_BANNERS</a></li><li><a href="global.html#HomeBannerItem">HomeBannerItem</a></li><li><a href="global.html#HomePage">HomePage</a></li><li><a href="global.html#HorseAges">HorseAges</a></li><li><a href="global.html#HorseDetailPanel">HorseDetailPanel</a></li><li><a href="global.html#InfoPanel">InfoPanel</a></li><li><a href="global.html#ItemWrapper">ItemWrapper</a></li><li><a href="global.html#ListingsTab">ListingsTab</a></li><li><a href="global.html#ProfileTab">ProfileTab</a></li><li><a href="global.html#sellUserHorse">sellUserHorse</a></li><li><a href="global.html#useAutoAnimate">useAutoAnimate</a></li><li><a href="global.html#useForceUpdate">useForceUpdate</a></li><li><a href="global.html#useLoading">useLoading</a></li><li><a href="global.html#ViewLayout">ViewLayout</a></li></ul></div><div class="category"><h2>@api</h2><h3>Global</h3><ul><li><a href="global.html#getHorseColours">getHorseColours</a></li><li><a href="global.html#getListingTypes">getListingTypes</a></li><li><a href="global.html#updateHorseDetail">updateHorseDetail</a></li><li><a href="global.html#useGetHorseColours">useGetHorseColours</a></li><li><a href="global.html#useGetListingTypes">useGetListingTypes</a></li></ul></div><div class="category"><h2>@components</h2><h3>Components</h3><ul><li><a href="CountryEditPanel.html">CountryEditPanel</a></li><li><a href="HorseEditFormModal.html">HorseEditFormModal</a></li><li><a href="InfoEditPanel.html">InfoEditPanel</a></li><li><a href="NewsPreview.html">NewsPreview</a></li></ul></div><div class="category"><h2>@containers</h2><h3>Components</h3><ul><li><a href="Layout.html">Layout</a></li></ul></div><div class="category"><h2>@ui</h2><h3>Components</h3><ul><li><a href="Button.html">Button</a></li><li><a href="Carousel.html">Carousel</a></li><li><a href="Checkbox.html">Checkbox</a></li><li><a href="DatePicker.html">DatePicker</a></li><li><a href="Drawer.html">Drawer</a></li><li><a href="Editor.html">Editor</a></li><li><a href="Ellipsis.html">Ellipsis</a></li><li><a href="Empty.html">Empty</a></li><li><a href="Form.html">Form</a></li><li><a href="Input.html">Input</a></li><li><a href="Input.Group.html">Group</a></li><li><a href="Input.Password.html">Password</a></li><li><a href="Input.Search.html">Search</a></li><li><a href="Input.TextArea.html">TextArea</a></li><li><a href="Menu.html">Menu</a></li><li><a href="Modal.html">Modal</a></li><li><a href="Notification.html">Notification</a></li><li><a href="Progress.html">Progress</a></li><li><a href="Radio.html">Radio</a></li><li><a href="RangePicker.html">RangePicker</a></li><li><a href="Result.html">Result</a></li><li><a href="Segmented.html">Segmented</a></li><li><a href="Select.html">Select</a></li><li><a href="Spin.html">Spin</a></li><li><a href="Upload.html">Upload</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>containers/private/listings.tsx</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { RightOutlined, SearchOutlined } from '@ant-design/icons'
import { useGetUserHorse, useGetUserHorses, useSellUserHorse } from '@api'
import { FieldDropdown, HorseDetailPanel, NoResult } from '@components'
import { Messages } from '@constants'
import { horseStatusFilters } from '@constants/enum'
import styled from '@emotion/styled'
import { Horse, SearchSelectField, UserHorsesRequest } from '@interfaces'
import { Button, Drawer, Ellipsis, Empty, Form, Input, Menu, Modal, notification } from '@ui'
import { Grid, Layout, Skeleton, Space } from 'antd'
import { includes } from 'lodash'
import { useEffect, useMemo, useState } from 'react'
import InfiniteScroll from 'react-infinite-scroll-component'
import { useDebounce } from 'react-use'

const { Sider, Content } = Layout
const { useBreakpoint } = Grid

/**
 * Account horse listing page (BEx Syndications).
 */
export const ListingsTab = () => {
  const screens = useBreakpoint()
  const [form] = Form.useForm()
  const [selectedKeys, setSelectedKeys] = useState&lt;string[]>()
  const [drawerVisible, setDrawerVisible] = useState(false)
  const [horsesRequest, setHorsesRequest] = useState&lt;UserHorsesRequest>({
    pageIndex: 0,
    pageSize: 30,
  })
  const [searchValue, setSearchValue] = useState('')
  const selectedItems = Form.useWatch&lt;number[]>('filter', form)

  const {
    data: horsesResp,
    refetch: refetchHorses,
    isFetching,
    hasNextPage,
    fetchNextPage,
  } = useGetUserHorses(horsesRequest)
  const horses = useMemo(
    () =>
      horsesResp?.pages?.reduce((prev, current) => [...prev, ...(current?.data?.responseData || [])], [] as Horse[]),
    [horsesResp]
  )

  const { data: horseResp, refetch: refetchHorse } = useGetUserHorse(selectedKeys?.toString())
  const horse = useMemo(() => horseResp?.data?.responseData, [horseResp])

  const menuItems = horses?.map(horse => ({
    label: (
      &lt;Ellipsis
        title={screens.lg ? horse?.horseName || horse?.name : null}
        maxLines={1}
        placement='right'
      >
        {horse?.horseName || horse?.name}
      &lt;/Ellipsis>
    ),
    key: horse?.id,
  }))

  useEffect(() => {
    if (horses?.length > 0) {
      setSelectedKeys([horses[0].id.toString()])
    }
  }, [setSelectedKeys, horses])

  const onFilterValueChange = (value: (number | string)[]) => {
    if (includes(value, 'approved')) {
      const selected = value.filter(item => item !== 'approved')
      setHorsesRequest(values => ({
        ...values,
        approved: true,
        statuses: selected as number[],
      }))
    } else if (!includes(value, 'approved')) {
      setHorsesRequest(values => ({
        ...values,
        approved: false,
        statuses: value as number[],
      }))
    }
  }

  const filtersField: SearchSelectField = {
    name: 'filter',
    placeholder: 'Choose filter',
    options: horseStatusFilters,
    mode: 'multiple',
    showSearch: false,
    noStyle: true,
    onChange: onFilterValueChange,
    labelInValue: false,
  }

  const { mutateAsync: relistHorse } = useSellUserHorse({
    onSuccess: resp => {
      const responseData = resp?.data?.responseData
      const error = resp?.data?.error

      if (responseData) {
        notification.success({
          message: Messages.RelistHorseSuccess
        })
        refetchHorse()
        refetchHorses()
      } else if (error) {
        console.error(error)
        notification.error({
          message: error?.message
        })
      }
    },
    onError: error => {
      console.error(error)
      notification.error({
        message: error?.message
      })
    },
  })

  const { mutateAsync: markHorseAsSold } = useSellUserHorse({
    onSuccess: resp => {
      const responseData = resp?.data?.responseData
      const error = resp?.data?.error

      if (responseData) {
        notification.success({
          message: Messages.MarkHorseSoldSuccess
        })
        refetchHorse()
        refetchHorses()
      } else if (error) {
        console.log(error)
        notification.error({
          message: error?.message
        })
      }
    },
    onError: error => {
      console.error(error)
      notification.error({
        message: error?.message
      })
    },
  })

  const relist = () => {
    Modal.confirm({
      title: 'Confirm',
      content: Messages.RelistConfirm,
      okText: 'Yes',
      okType: 'primary',
      cancelText: 'No',
      onOk: () => relistHorse(selectedKeys[0]),
    })
  }

  const markAsSold = () => {
    Modal.confirm({
      title: 'Confirm',
      content: Messages.MarkSoldConfirm,
      okText: 'Yes',
      okType: 'primary',
      cancelText: 'No',
      onOk: () => markHorseAsSold(selectedKeys[0]),
    })
  }

  useEffect(() => {
    if (horses?.length === 0) {
      setSelectedKeys(undefined)
    }

    if (selectedItems === undefined) {
      onFilterValueChange(undefined)
    }
  }, [horses?.length, selectedItems])

  useDebounce(
    () => {
      setHorsesRequest(values => ({
        ...values,
        query: searchValue ?? undefined,
      }))
    },
    300,
    [searchValue]
  )

  return (
    &lt;MyHorseTabWrapper
      className='h-full max-h-full'
      hasSider
    >
      &lt;Sider
        className='lg:block hidden rounded-sm w'
        theme='light'
        width={288}
      >
        &lt;div className='rounded-sm bg-white sticky top-18'>
          &lt;Form
            form={form}
            size='large'
          >
            &lt;Space
              className='w-full px-5 py-4'
              direction='vertical'
            >
              &lt;Form.Item
                name='query'
                noStyle
              >
                &lt;Input
                  placeholder='Search'
                  onChange={event => {
                    const value = event.currentTarget.value
                    setSearchValue(value)
                  }}
                  suffix={&lt;SearchOutlined className='text-neutral-100' />}
                />
              &lt;/Form.Item>
              &lt;FieldDropdown
                field={filtersField}
                formInstance={form}
              />
            &lt;/Space>
          &lt;/Form>
          {menuItems?.length > 0 ? (
            &lt;InfiniteScroll
              dataLength={horses?.length}
              hasMore={hasNextPage}
              next={fetchNextPage}
              loader={null}
              scrollableTarget='horse-list-menu'
            >
              &lt;Menu
                id='horse-list-menu'
                className='max-h-[60vh] overflow-x-hidden overflow-y-auto'
                mode='inline'
                items={menuItems}
                defaultSelectedKeys={selectedKeys}
                selectedKeys={selectedKeys}
                onSelect={({ key }) => {
                  setSelectedKeys([key])
                }}
              />
            &lt;/InfiniteScroll>
          ) : isFetching ? (
            &lt;Skeleton
              className='p-4'
              title={false}
              paragraph={{
                rows: 5,
              }}
              active
            />
          ) : (
            &lt;div className='p-4'>
              &lt;Empty description='We did not find any horses for your search.' />
            &lt;/div>
          )}
        &lt;/div>
      &lt;/Sider>
      &lt;Content className='lg:pl-4 lg:px-0 px-4'>
        &lt;Button
          className='lg:hidden block fixed top-40 sm:left-4 left-0 z-40 shadow-md'
          type='primary'
          shape='circle'
          icon={&lt;RightOutlined />}
          onClick={() => setDrawerVisible(!drawerVisible)}
        />
        {!screens.lg &amp;&amp; (
          &lt;Drawer
            placement='left'
            open={drawerVisible}
            onClose={() => setDrawerVisible(false)}
            closable={false}
            width={320}
            bodyStyle={{
              padding: 0,
              maxHeight: '100vh',
              overflow: 'hidden'
            }}
            forceRender
          >
            &lt;Form
              form={form}
              size='large'
            >
              &lt;Space
                className='lg:px-2 px-4 py-4 w-full'
                direction='vertical'
              >
                &lt;Form.Item
                  name='query'
                  noStyle
                >
                  &lt;Input
                    placeholder='Search'
                    onChange={event => {
                      const value = event.currentTarget.value
                      setSearchValue(value)
                    }}
                    suffix={&lt;SearchOutlined className='text-neutral-100' />}
                  />
                &lt;/Form.Item>
                &lt;FieldDropdown
                  field={filtersField}
                  formInstance={form}
                />
              &lt;/Space>
            &lt;/Form>
            {menuItems?.length > 0 ? (
              &lt;div
                id='division-wrapper'
                className='h-[calc(100vh-120px)] max-h-[calc(100vh-120px)] sm:pb-0 pb-20 overflow-auto'
              >
                &lt;InfiniteScroll
                  dataLength={horses?.length}
                  hasMore={hasNextPage}
                  next={fetchNextPage}
                  loader={
                    &lt;Skeleton
                      active
                      paragraph={false}
                    />
                  }
                  scrollableTarget='division-wrapper'
                >
                  &lt;Menu
                    className='overflow-x-hidden'
                    mode='inline'
                    items={menuItems}
                    defaultSelectedKeys={selectedKeys}
                    selectedKeys={selectedKeys}
                    onSelect={({ key }) => {
                      setSelectedKeys([key])
                      setDrawerVisible(false)
                    }}
                  />
                &lt;/InfiniteScroll>
              &lt;/div>
            ) : isFetching ? (
              &lt;Skeleton
                className='p-4'
                title={false}
                paragraph={{
                  rows: 5,
                }}
                active
              />
            ) : (
              &lt;div className='p-4'>
                &lt;Empty description='We did not find any horses for your search.' />
              &lt;/div>
            )}
          &lt;/Drawer>
        )}
        {selectedKeys ? (
          &lt;HorseDetailPanel
            horse={horse}
            relist={relist}
            markAsSold={markAsSold}
          />
        ) : (
          !isFetching &amp;&amp; &lt;NoResult contentType='horse' />
        )}
      &lt;/Content>
    &lt;/MyHorseTabWrapper>
  )
}

const MyHorseTabWrapper = styled(Layout)`
  .ant-layout-sider {
    &amp;.ant-layout-sider-light {
      background-color: transparent;
    }

    .ant-layout-sider-children {
      .ant-menu {
        &amp;.ant-menu-inline {
          background-color: rgba(0, 0, 0, 0);
          transition: all 0.5s cubic-bezier(0.5, 0, 0.5, 1);
          -webkit-background-clip: text;
          background-clip: text;

          &amp;::-webkit-scrollbar {
            background-color: transparent;
            display: none;
          }

          &amp;::-webkit-scrollbar-track {
            background-color: transparent;
          }

          &amp;::-webkit-scrollbar-thumb {
            background-color: inherit;
            border-radius: 0;
          }

          &amp;:hover {
            background-color: var(--primary);

            &amp;::-webkit-scrollbar {
              display: block;
            }
          }
        }
      }
    }
  }

  .ant-drawer {
    &amp;.ant-drawer-left {
      .ant-drawer-content-wrapper {
        .ant-drawer-content {
          overflow: visible;

          .ant-drawer-wrapper-body {
            .ant-drawer-body {
              padding: 8px;

              &amp;::-webkit-scrollbar {
                background-color: #ffffff;
                width: 12px;
                height: 12px;
              }

              &amp;::-webkit-scrollbar-track {
                background-color: transparent;
                -webkit-box-shadow: none;
                box-shadow: none;
              }

              &amp;::-webkit-scrollbar-thumb {
                background-color: rgba(0, 0, 0, 0.4);
                padding: 4px;
                border: 4px solid transparent;
                background-clip: padding-box;
              }
            }
          }
        }
      }
    }
  }
`
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>


</body>
</html>
